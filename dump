import os
import base64
from dotenv import load_dotenv
load_dotenv()
from sendgrid import SendGridAPIClient
from sendgrid.helpers.mail import Mail, Attachment, FileContent, FileName, FileType, Disposition

def send_notification(to_email, subject, content, attachment_path=None):
    from_email = 'telecomproject4@gmail.com' 
    sendgrid_api_key = os.environ.get('SENDGRID_API_KEY') 

    message = Mail(
        from_email=from_email,
        to_emails=to_email,
        subject=subject,
        html_content=content
    )

    if attachment_path:
        # Read and encode the file
        with open(attachment_path, 'rb') as f:
            data = f.read()
        encoded_file = base64.b64encode(data).decode()

        # Prepare the attachment
        filename = os.path.basename(attachment_path)
        attachment = Attachment(
            FileContent(encoded_file),
            FileName(filename),
            FileType('application/vnd.openxmlformats-officedocument.wordprocessingml.document'),  # DOCX MIME type
            Disposition('attachment')
        )
        message.attachment = attachment

    try:
        sg = SendGridAPIClient(sendgrid_api_key)
        response = sg.send(message)
        print(f"Email sent! Status Code: {response.status_code}")
        return response.status_code
    except Exception as e:
        print(f"Error sending email: {e}")
        return None
