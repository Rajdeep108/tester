@router.get("/api/download/{filename}")
async def download_file(filename: str):
    """Endpoint to download a file"""
    try:
        # Security: Basic check to prevent directory traversal
        if ".." in filename or "/" in filename or "\\" in filename:
            raise HTTPException(status_code=400, detail="Invalid filename")
            
        file_path = os.path.join(SHAREPOINT_DIR, filename)
        
        if not os.path.isfile(file_path):
            raise HTTPException(status_code=404, detail="File not found")
        
        # Return the file for download
        return FileResponse(
            file_path,
            filename=filename,
            media_type="application/octet-stream"
        )
            
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))



const handleDownload = async (filename) => {
  try {
    const response = await fetch(`http://localhost:8000/api/download/${encodeURIComponent(filename)}`);
    const blob = await response.blob();
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.style.display = 'none';
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
  } catch (error) {
    console.error('Download failed:', error);
  }
};

// Then in your button:
<Button
  variant="ghost"
  size="icon"
  onClick={() => handleDownload(file.renamed_filename || file.filename)}
>
  <Download className="h-4 w-4 text-blue-500" />
</Button>
