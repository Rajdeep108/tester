import openai
import os
from dotenv import load_dotenv

load_dotenv()

openai.api_type = os.getenv("OPENAI_TYPE")
openai.api_base = os.getenv("OPENAI_BASE")
openai.api_version = os.getenv("OPENAI_VERSION")
openai.api_key = os.getenv("OPENAI_API_KEY")
OPENAI_DEPLOYMENT_NAME = os.getenv("OPENAI_DEPLOYMENT")


os.environ["LANGCHAIN_TRACING_V2"] = "true"
os.environ["LANGCHAIN_PROJECT"]="crawler-insights"
os.environ["LANGCHAIN_API_KEY"]="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"

from langsmith.run_helpers import traceable 

@traceable(run_type="llm")
def chat_completion(user_prompt:str, system_instruction:str):
    response = openai.ChatCompletion.create(
        engine=OPENAI_DEPLOYMENT_NAME,
        messages=[
            {"role": "system", "content": system_instruction},
            {"role": "user", "content": user_prompt}
        ]
    )
    return response.choices[0].message.content.strip()
